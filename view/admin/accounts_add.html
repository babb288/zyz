<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>用户管理</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
  <link rel="stylesheet" href="/css/public.css" media="all">
  <style>
    .avatar-uploader {
      margin-bottom: 15px;
    }
    .avatar-preview {
      position: relative;
      width: 100px;
      height: 100px;
      border: 1px dashed #d9d9d9;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .avatar-actions {
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>

<body>
<div class="layuimini-container">
  <div class="layuimini-main">

    <form class="layui-form" action="">


      <div class="layui-form-item">
        <label class="layui-form-label">用户名</label>
        <div class="layui-input-block">
          <input type="text" name="username" lay-verify="required" autocomplete="off" placeholder="请输入..." class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">密码</label>
        <div class="layui-input-block">
          <input type="password" name="password" lay-verify="required" autocomplete="off" placeholder="请输入..." class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">账号类型</label>
        <div class="layui-input-block">
          <input type="radio" name="type" value="business" title="业务员" checked>
            <input type="radio" name="type" value="super" title="管理员">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">账号状态</label>
        <div class="layui-input-block">
          <input type="radio" name="status" value="1" title="开启" checked>
          <input type="radio" name="status" value="0" title="关闭">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
          <input type="text" name="remark" autocomplete="off" placeholder="请输入..." class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit="" lay-filter="form-submit" style="display: none;" >立即提交</button>
        </div>
      </div>

    </form>

  </div>
</div>
<script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="../js/md5.js" charset="utf-8"></script>
<script>
  layui.use(['form', 'upload'], function() {
    var form = layui.form,
        upload = layui.upload,
        layer = layui.layer;
    
    // 表单验证
    form.verify({
      username: function(value) {
        if (value.length < 2) {
          return '用户名至少2个字符';
        }
      },
      password: function(value) {
        if (value.length < 6) {
          return '密码至少6个字符';
        }
      }
    });
    
    // 监听提交
    form.on('submit(form-submit)', function(data) {
      console.log('提交数据:', data.field);
      
      // 对密码进行MD5加密
      data.field.password = hex_md5(data.field.password);
      
      $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '/admin/accounts/add',
        data: data.field,
        success: function(result) {
          if (result.code === 1) {
            layer.msg('添加成功', {icon: 1});
            
            // 2秒后关闭当前iframe层并刷新父页面
            setTimeout(function() {
              var index = parent.layer.getFrameIndex(window.name);
              parent.layer.close(index);
              parent.location.reload();
            }, 2000);
            
          } else {
            layer.msg(result.msg, {icon: 2});
          }
        },
        error: function() {
          layer.msg('请求失败，请重试', {icon: 2});
        }
      });
      
      return false; // 阻止表单默认提交
    });
  });
</script>
</body>
</html>