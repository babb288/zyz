<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
  <link rel="stylesheet" href="/css/public.css" media="all">
</head>

<body>
<div class="layuimini-container">
  <div class="layuimini-main">

    <form lay-filter="accounts" class="layui-form" action="" >

      <div class="layui-form-item">
        <label class="layui-form-label">用户名</label>
        <div class="layui-input-block">
          <input type="text" name="username" lay-verify="username"  value="" autocomplete="off" placeholder="请输入..." class="layui-input" disabled>
        </div>
      </div>


      <div class="layui-form-item">
        <label class="layui-form-label">密码</label>
        <div class="layui-input-block">
          <input type="password" name="password" lay-verify="password" autocomplete="off" placeholder="密码留空则为不更改" class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">账号类型</label>
        <div class="layui-input-block">
          <input type="radio" name="type" value="business" title="业务员" checked>
          <input type="radio" name="type" value="administrator" title="组长" >
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">账号状态</label>
        <div class="layui-input-block">
          <input type="radio" name="status" value="1" title="开启" checked>
          <input type="radio" name="status" value="0" title="关闭" >
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
          <input type="text" name="remark" lay-verify="remark" autocomplete="off" placeholder="请输入..." class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit="" lay-filter="click" lay-submit style="display: none">立即提交</button>
        </div>
      </div>

    </form>



  </div>
</div>
<script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="../js/md5.js" charset="utf-8"></script>
<script>
  layui.use(['form', 'layedit', 'laydate'], function() {
    var form = layui.form,
            layer = layui.layer,
            layedit = layui.layedit,
            laydate = layui.laydate;
    var editIndex = layedit.build('LAY_demo_editor');

    var data = {
      username:"{$user_info['username']}",
      type:"{$user_info['type']}",
      status:"{$user_info['status']}",
      remark:"{$user_info['remark']}"
    }

    form.val('accounts',data);

    //表单验证
    form.verify({
      phone: function(phone) {
        if (phone.length < 2) {
          return '用户名输入错误';
        }
      },
      content: function(value) {
        layedit.sync(editIndex);
      }
    });


    form.on('submit(click)', function(data) {
      const url = new URL(window.location.href);
      const params = new URLSearchParams(url.search);

      $.ajax({
        type:'POST',
        dataType:'json',
        url:'/admin/accounts/edit?id='+params.get('id'),
        data:data.field,
        success:function(result){

          if(result.code===1){

            layer.msg('成功',{icon:1});

            setTimeout( function(){var index = parent.layer.getFrameIndex(window.name);parent.layer.close(index);}, 2 * 1000 );

            setTimeout( function(){parent.location.reload();}, 2 * 1000 );

          }else{
            layer.msg(result.msg,{icon:2});

            //setTimeout( function(){var index = parent.layer.getFrameIndex(window.name);parent.layer.close(index);}, 2 * 1000 );

            //setTimeout( function(){parent.location.reload();}, 2 * 1000 );
          }
        }
      });

      return false;

    });
  });


</script>


</body>

</html>